
let chatRoll = document.querySelector(".window__chat-content");


document.querySelector("#desktop_search_btn").onclick = async () => {

    let messageText = document.querySelector("#desktop_search_input").value;
    document.querySelector("#desktop_search_input").value = '';

    if (messageText.trim() !== "") {
        chatRoll.innerHTML +=
            `<div class="user_message">
                <div class="user_message__card">
                    <div class="user_message__text">${messageText}</div>
                </div>
            </div>`;


        let mess = '';

        await fetch("https://ai-meneger-edward0076.amvera.io/chat_gpt/messages/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },

            body: JSON.stringify({
                chat_id: 1,
                content: String(messageText)
            })
        })
            .then(res => res.json())
            .then(res => {
                mess = res.message;
            });

        let sentences = mess.split("\n");

        let gptMessage = ``;

        sentences.forEach(sentence => {
            let title_order = 0;

            for (let i = 0; i < sentence.length; i++) {
                if (sentence[i] === "#") {
                    title_order++;
                }
                else {
                    break;
                }
            }

            // Cutting # markers in beginning
            sentence = sentence.slice((title_order == 0) ? 0 : title_order + 1);

            let tag = "";
            if (title_order === 0) {
                tag = "p";
            }
            else {
                tag = "h" + title_order;
            }

            gptMessage +=
                `
            <${tag}>
                ${(sentence.trim() !== "") ? sentence.trim() : "<span class='msg_whitespace'></span>"}
            </${tag}>
            `;

        });

        chatRoll.innerHTML +=
            `
        <div class="gpt_message">
            <div class="gpt_message__card">
                ${gptMessage}

                <div class="gpt_message__footer">
                <div class="gpt_message__footer-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M5.8999 10.1C5.8999 8.12039 5.8999 7.12989 6.5152 6.51529C7.1298 5.89999 8.1203 5.89999 10.0999 5.89999H10.7999C12.7795 5.89999 13.77 5.89999 14.3846 6.51529C14.9999 7.12989 14.9999 8.12039 14.9999 10.1V10.8C14.9999 12.7796 14.9999 13.7701 14.3846 14.3847C13.77 15 12.7795 15 10.7999 15H10.0999C8.1203 15 7.1298 15 6.5152 14.3847C5.8999 13.7701 5.8999 12.7796 5.8999 10.8V10.1Z"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M11.5 5.9C11.4979 3.8301 11.4671 2.7577 10.8644 2.0234C10.7481 1.88175 10.6182 1.75186 10.4766 1.6356C9.701 1 8.5516 1 6.25 1C3.9491 1 2.7983 1 2.0234 1.6356C1.88175 1.75186 1.75186 1.88175 1.6356 2.0234C1 2.799 1 3.9484 1 6.25C1 8.5509 1 9.7017 1.6356 10.4766C1.75186 10.6182 1.88175 10.7481 2.0234 10.8644C2.7584 11.4664 3.8294 11.4986 5.9 11.5"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="gpt_message__footer-btn">
                    <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M1 7.35281C1 6.97838 1.1475 6.61928 1.41004 6.35452C1.67259 6.08976 2.02867 5.94101 2.39997 5.94101C2.95691 5.94101 3.49104 6.16413 3.88486 6.56127C4.27868 6.95842 4.49992 7.49706 4.49992 8.05871V10.8823C4.49992 11.444 4.27868 11.9826 3.88486 12.3797C3.49104 12.7769 2.95691 13 2.39997 13C2.02867 13 1.67259 12.8513 1.41004 12.5865C1.1475 12.3217 1 11.9626 1 11.5882V7.35281ZM10.4351 4.03932L10.2482 4.6464C10.0956 5.14405 10.0193 5.39253 10.0781 5.58948C10.1276 5.74927 10.2318 5.88612 10.3721 5.9756C10.5478 6.08713 10.8131 6.08713 11.3451 6.08713H11.6279C13.4268 6.08713 14.3263 6.08713 14.7512 6.62362C14.7997 6.68527 14.8429 6.75044 14.8807 6.81915C15.2076 7.41775 14.8359 8.2246 14.0925 9.83828C13.4107 11.3193 13.0691 12.0597 12.4364 12.4953C12.3748 12.5376 12.3118 12.5776 12.2474 12.6153C11.581 13 10.755 13 9.10303 13H8.74533C6.74338 13 5.7431 13 5.12151 12.3929C4.49992 11.7851 4.49992 10.8075 4.49992 8.85214V8.16459C4.49992 7.13751 4.49992 6.62362 4.68052 6.15278C4.86182 5.68265 5.20761 5.29653 5.9006 4.52286L8.76423 1.32514C8.83633 1.24467 8.87203 1.20514 8.90423 1.1769C9.04741 1.05242 9.23324 0.989442 9.42191 1.00145C9.61058 1.01346 9.78708 1.0995 9.91361 1.24114C9.94161 1.2729 9.97171 1.31738 10.0326 1.40632C10.1271 1.54468 10.174 1.61385 10.2153 1.68303C10.5849 2.29787 10.6962 3.02847 10.5275 3.72308C10.5086 3.80002 10.4841 3.87979 10.4351 4.03932Z"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="gpt_message__footer-btn">
                    <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M15 6.65015C15 7.02144 14.8525 7.37753 14.59 7.64008C14.3274 7.90262 13.9713 8.05012 13.6 8.05012C13.0431 8.05012 12.509 7.82887 12.1151 7.43506C11.7213 7.04124 11.5001 6.50711 11.5001 5.95016L11.5001 3.15022C11.5001 2.59328 11.7213 2.05915 12.1151 1.66533C12.509 1.27151 13.0431 1.05027 13.6 1.05027C13.9713 1.05027 14.3274 1.19777 14.59 1.46031C14.8525 1.72286 15 2.07894 15 2.45024L15 6.65015ZM5.5649 9.93588L5.7518 9.33389C5.90439 8.8404 5.98069 8.59401 5.92189 8.39871C5.8724 8.24026 5.7682 8.10455 5.6279 8.01582C5.4522 7.90522 5.18691 7.90522 4.65492 7.90522L4.37213 7.90522C2.57317 7.90522 1.67369 7.90522 1.24879 7.37323C1.20026 7.3121 1.1571 7.24747 1.1193 7.17934C0.792405 6.58575 1.1641 5.78567 1.90748 4.1855C2.58927 2.71693 2.93086 1.98265 3.56365 1.55076C3.62524 1.50876 3.68824 1.46909 3.75264 1.43176C4.41903 1.05027 5.24501 1.05027 6.89697 1.05027L7.25467 1.05027C9.25662 1.05027 10.2569 1.05027 10.8785 1.65226C11.5001 2.25494 11.5001 3.22442 11.5001 5.16338L11.5001 5.84517C11.5001 6.86364 11.5001 7.37323 11.3195 7.84012C11.1382 8.30631 10.7924 8.6892 10.0994 9.45639L7.23577 12.6273C7.16367 12.7071 7.12797 12.7463 7.09577 12.7743C6.95259 12.8978 6.76676 12.9602 6.57809 12.9483C6.38942 12.9364 6.21292 12.8511 6.08639 12.7106C6.05839 12.6791 6.02829 12.635 5.96739 12.5468C5.8729 12.4096 5.826 12.341 5.7847 12.2724C5.41511 11.6627 5.30381 10.9383 5.4725 10.2495C5.4914 10.1732 5.5159 10.0941 5.5649 9.93588Z"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="gpt_message__footer-btn">
                    <svg width="17" height="14" viewBox="0 0 17 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.99963 9.11047V4.88957C9.99963 2.53088 9.99963 1.3519 9.30584 1.05791C8.6113 0.764668 7.7945 1.5979 6.1609 3.26661C5.31485 4.13059 4.83257 4.32183 3.62875 4.32183C2.57643 4.32183 2.0499 4.32183 1.67113 4.57983C0.886578 5.11531 1.00659 6.16154 1.00659 7.00002C1.00659 7.8385 0.887328 8.88472 1.67263 9.42021C2.05065 9.6782 2.57718 9.6782 3.6295 9.6782C4.83332 9.6782 5.3156 9.86945 6.16165 10.7334C7.79525 12.4014 8.61205 13.2354 9.30659 12.9421C10.0004 12.6481 10.0004 11.4692 10.0004 9.10972M12.2498 4.75007C12.7185 5.36506 12.9998 6.14729 12.9998 7.00002C12.9998 7.85275 12.7185 8.63498 12.2498 9.24996M14.4999 3.25011C15.4375 4.27458 16 5.57955 16 7.00002C16 8.42048 15.4375 9.72545 14.4999 10.7499" stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>

            </div>
        </div>
        `;

    }
};

// For mobile

document.querySelector("#mobile_search_btn").onclick = async () => {
    
    let messageText = document.querySelector("#mobile_search_input").value;
    document.querySelector("#mobile_search_input").value = '';

    if (messageText.trim() !== "") {
        chatRoll.innerHTML +=
            `<div class="user_message">
                <div class="user_message__card">
                    <div class="user_message__text">${messageText}</div>
                </div>
            </div>`;


        let mess = '';

        await fetch("https://ai-meneger-edward0076.amvera.io/chat_gpt/messages/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },

            body: JSON.stringify({
                chat_id: 1,
                content: String(messageText)
            })
        })
            .then(res => res.json())
            .then(res => {
                mess = res.message;
            });

        let sentences = mess.split("\n");

        let gptMessage = ``;

        sentences.forEach(sentence => {
            let title_order = 0;

            for (let i = 0; i < sentence.length; i++) {
                if (sentence[i] === "#") {
                    title_order++;
                }
                else {
                    break;
                }
            }

            // Cutting # markers in beginning
            sentence = sentence.slice((title_order == 0) ? 0 : title_order + 1);

            let tag = "";
            if (title_order === 0) {
                tag = "p";
            }
            else {
                tag = "h" + title_order;
            }

            gptMessage +=
                `
            <${tag}>
                ${(sentence.trim() !== "") ? sentence.trim() : "<span class='msg_whitespace'></span>"}
            </${tag}>
            `;

        });

        chatRoll.innerHTML +=
            `
        <div class="gpt_message">
            <div class="gpt_message__card">
                ${gptMessage}

                <div class="gpt_message__footer">
                <div class="gpt_message__footer-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M5.8999 10.1C5.8999 8.12039 5.8999 7.12989 6.5152 6.51529C7.1298 5.89999 8.1203 5.89999 10.0999 5.89999H10.7999C12.7795 5.89999 13.77 5.89999 14.3846 6.51529C14.9999 7.12989 14.9999 8.12039 14.9999 10.1V10.8C14.9999 12.7796 14.9999 13.7701 14.3846 14.3847C13.77 15 12.7795 15 10.7999 15H10.0999C8.1203 15 7.1298 15 6.5152 14.3847C5.8999 13.7701 5.8999 12.7796 5.8999 10.8V10.1Z"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M11.5 5.9C11.4979 3.8301 11.4671 2.7577 10.8644 2.0234C10.7481 1.88175 10.6182 1.75186 10.4766 1.6356C9.701 1 8.5516 1 6.25 1C3.9491 1 2.7983 1 2.0234 1.6356C1.88175 1.75186 1.75186 1.88175 1.6356 2.0234C1 2.799 1 3.9484 1 6.25C1 8.5509 1 9.7017 1.6356 10.4766C1.75186 10.6182 1.88175 10.7481 2.0234 10.8644C2.7584 11.4664 3.8294 11.4986 5.9 11.5"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="gpt_message__footer-btn">
                    <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M1 7.35281C1 6.97838 1.1475 6.61928 1.41004 6.35452C1.67259 6.08976 2.02867 5.94101 2.39997 5.94101C2.95691 5.94101 3.49104 6.16413 3.88486 6.56127C4.27868 6.95842 4.49992 7.49706 4.49992 8.05871V10.8823C4.49992 11.444 4.27868 11.9826 3.88486 12.3797C3.49104 12.7769 2.95691 13 2.39997 13C2.02867 13 1.67259 12.8513 1.41004 12.5865C1.1475 12.3217 1 11.9626 1 11.5882V7.35281ZM10.4351 4.03932L10.2482 4.6464C10.0956 5.14405 10.0193 5.39253 10.0781 5.58948C10.1276 5.74927 10.2318 5.88612 10.3721 5.9756C10.5478 6.08713 10.8131 6.08713 11.3451 6.08713H11.6279C13.4268 6.08713 14.3263 6.08713 14.7512 6.62362C14.7997 6.68527 14.8429 6.75044 14.8807 6.81915C15.2076 7.41775 14.8359 8.2246 14.0925 9.83828C13.4107 11.3193 13.0691 12.0597 12.4364 12.4953C12.3748 12.5376 12.3118 12.5776 12.2474 12.6153C11.581 13 10.755 13 9.10303 13H8.74533C6.74338 13 5.7431 13 5.12151 12.3929C4.49992 11.7851 4.49992 10.8075 4.49992 8.85214V8.16459C4.49992 7.13751 4.49992 6.62362 4.68052 6.15278C4.86182 5.68265 5.20761 5.29653 5.9006 4.52286L8.76423 1.32514C8.83633 1.24467 8.87203 1.20514 8.90423 1.1769C9.04741 1.05242 9.23324 0.989442 9.42191 1.00145C9.61058 1.01346 9.78708 1.0995 9.91361 1.24114C9.94161 1.2729 9.97171 1.31738 10.0326 1.40632C10.1271 1.54468 10.174 1.61385 10.2153 1.68303C10.5849 2.29787 10.6962 3.02847 10.5275 3.72308C10.5086 3.80002 10.4841 3.87979 10.4351 4.03932Z"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="gpt_message__footer-btn">
                    <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M15 6.65015C15 7.02144 14.8525 7.37753 14.59 7.64008C14.3274 7.90262 13.9713 8.05012 13.6 8.05012C13.0431 8.05012 12.509 7.82887 12.1151 7.43506C11.7213 7.04124 11.5001 6.50711 11.5001 5.95016L11.5001 3.15022C11.5001 2.59328 11.7213 2.05915 12.1151 1.66533C12.509 1.27151 13.0431 1.05027 13.6 1.05027C13.9713 1.05027 14.3274 1.19777 14.59 1.46031C14.8525 1.72286 15 2.07894 15 2.45024L15 6.65015ZM5.5649 9.93588L5.7518 9.33389C5.90439 8.8404 5.98069 8.59401 5.92189 8.39871C5.8724 8.24026 5.7682 8.10455 5.6279 8.01582C5.4522 7.90522 5.18691 7.90522 4.65492 7.90522L4.37213 7.90522C2.57317 7.90522 1.67369 7.90522 1.24879 7.37323C1.20026 7.3121 1.1571 7.24747 1.1193 7.17934C0.792405 6.58575 1.1641 5.78567 1.90748 4.1855C2.58927 2.71693 2.93086 1.98265 3.56365 1.55076C3.62524 1.50876 3.68824 1.46909 3.75264 1.43176C4.41903 1.05027 5.24501 1.05027 6.89697 1.05027L7.25467 1.05027C9.25662 1.05027 10.2569 1.05027 10.8785 1.65226C11.5001 2.25494 11.5001 3.22442 11.5001 5.16338L11.5001 5.84517C11.5001 6.86364 11.5001 7.37323 11.3195 7.84012C11.1382 8.30631 10.7924 8.6892 10.0994 9.45639L7.23577 12.6273C7.16367 12.7071 7.12797 12.7463 7.09577 12.7743C6.95259 12.8978 6.76676 12.9602 6.57809 12.9483C6.38942 12.9364 6.21292 12.8511 6.08639 12.7106C6.05839 12.6791 6.02829 12.635 5.96739 12.5468C5.8729 12.4096 5.826 12.341 5.7847 12.2724C5.41511 11.6627 5.30381 10.9383 5.4725 10.2495C5.4914 10.1732 5.5159 10.0941 5.5649 9.93588Z"
                            stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="gpt_message__footer-btn">
                    <svg width="17" height="14" viewBox="0 0 17 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.99963 9.11047V4.88957C9.99963 2.53088 9.99963 1.3519 9.30584 1.05791C8.6113 0.764668 7.7945 1.5979 6.1609 3.26661C5.31485 4.13059 4.83257 4.32183 3.62875 4.32183C2.57643 4.32183 2.0499 4.32183 1.67113 4.57983C0.886578 5.11531 1.00659 6.16154 1.00659 7.00002C1.00659 7.8385 0.887328 8.88472 1.67263 9.42021C2.05065 9.6782 2.57718 9.6782 3.6295 9.6782C4.83332 9.6782 5.3156 9.86945 6.16165 10.7334C7.79525 12.4014 8.61205 13.2354 9.30659 12.9421C10.0004 12.6481 10.0004 11.4692 10.0004 9.10972M12.2498 4.75007C12.7185 5.36506 12.9998 6.14729 12.9998 7.00002C12.9998 7.85275 12.7185 8.63498 12.2498 9.24996M14.4999 3.25011C15.4375 4.27458 16 5.57955 16 7.00002C16 8.42048 15.4375 9.72545 14.4999 10.7499" stroke="#8E8E93" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>

            </div>
        </div>
        `;

    }
};